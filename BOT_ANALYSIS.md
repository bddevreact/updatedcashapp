# ЁЯдЦ Bot.py - Balance ржПржмржВ Earnings рж▓ржЬрж┐ржХ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

## ЁЯУЛ **рж╕рж╛ржоржЧрзНрж░рж┐ржХ ржорзВрж▓рзНржпрж╛ржпрж╝ржи**

### тЬЕ **рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ:**

1. **рж░рзЗржлрж╛рж░рзЗрж▓ рж░рж┐ржУржпрж╝рж╛рж░рзНржб рж╕рж┐рж╕рзНржЯрзЗржо** - рз│2 per referral рж╕ржарж┐ржХ
2. **ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржЖржкржбрзЗржЯ рж▓ржЬрж┐ржХ** - ржЗржиржХрзНрж░рж┐ржорзЗржирзНржЯ рж╕ржарж┐ржХ
3. **ржЖрж░рзНржирж┐ржВрж╕ рж░рзЗржХрж░рзНржб** - рж╕ржарж┐ржХ ржбрж╛ржЯрж╛ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░
4. **ржлрж╛ржпрж╝рж╛рж░ржмрзЗрж╕ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи** - ржХрж╛ржирзЗржХрж╢ржи рж╕ржарж┐ржХ
5. **ржЧрзНрж░рзБржк ржорзЗржорзНржмрж╛рж░рж╢рж┐ржк ржЪрзЗржХ** - ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи рж╕ржарж┐ржХ

---

## ЁЯРЫ **рж╕ржорж╕рзНржпрж╛ржЧрзБрж▓рзЛ ржПржмржВ рж╕ржорж╛ржзрж╛ржи**

### **1. рж░рж┐ржлрж╛рж░рзЗрж▓ ржХрзЛржб ржЬрзЗржирж╛рж░рзЗрж╢ржи ржЕрж╕рж╛ржоржЮрзНржЬрж╕рзНржп**

#### **рж╕ржорж╕рзНржпрж╛:**
```python
# Bot.py ржП ржнрзБрж▓ ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕
def generate_referral_code(self, user_id: int) -> str:
    return f"BT{str(user_id)[-6:].upper()}"  # тЭМ BT ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕
```

#### **рж╕ржорж╛ржзрж╛ржи:**
```python
# тЬЕ рж╕ржарж┐ржХ ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕ (ржлрзНрж░ржирзНржЯржПржирзНржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓)
def generate_referral_code(self, user_id: int) -> str:
    return f"CP{str(user_id)[-6:].upper()}"  # тЬЕ CP ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕
```

#### **ржлрж╛ржЗрж▓:** `bot.py`

---

### **2. рж░рж┐ржлрж╛рж░рзЗрж▓ ржХрзЛржб рж▓рзБржХржЖржк ржЕрж╕рж╛ржоржЮрзНржЬрж╕рзНржп**

#### **рж╕ржорж╕рзНржпрж╛:**
```python
# ржкрзНрж░ржержорзЗ referral_codes ржХрж╛рж▓рзЗржХрж╢ржи ржЪрзЗржХ ржХрж░ржЫрзЗ
referral_codes_ref = bot_instance.db.collection('referral_codes')
query = referral_codes_ref.where('referral_code', '==', referral_code)
# рждрж╛рж░ржкрж░ users ржХрж╛рж▓рзЗржХрж╢ржи ржЪрзЗржХ ржХрж░ржЫрзЗ (fallback)
```

#### **рж╕ржорж╛ржзрж╛ржи:**
```python
# тЬЕ ржкрзНрж░ржержорзЗ users ржХрж╛рж▓рзЗржХрж╢ржи ржЪрзЗржХ (ржкрзНрж░рж╛ржЗржорж╛рж░рж┐ ржорзЗржержб)
users_ref = bot_instance.db.collection('users')
user_query = users_ref.where('referral_code', '==', referral_code).limit(1)
# рждрж╛рж░ржкрж░ referral_codes ржХрж╛рж▓рзЗржХрж╢ржи ржЪрзЗржХ (fallback)
```

#### **ржлрж╛ржЗрж▓:** `bot.py`

---

### **3. рж░рж┐ржлрж╛рж░рзЗрж▓ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж▓ржЬрж┐ржХ ржЙржирзНржирждрж┐**

#### **рж╕ржорж╕рзНржпрж╛:**
```python
# рж╢рзБржзрзБ referred_id ржжрж┐ржпрж╝рзЗ ржЪрзЗржХ ржХрж░ржЫрзЗ
existing_query = referrals_ref.where('referred_id', '==', referred_id).limit(1)
```

#### **рж╕ржорж╛ржзрж╛ржи:**
```python
# тЬЕ ржЙржнржпрж╝ referrer_id ржПржмржВ referred_id ржжрж┐ржпрж╝рзЗ ржЪрзЗржХ
existing_query = referrals_ref.where('referred_id', '==', referred_id).where('referrer_id', '==', referrer_id).limit(1)
# тЬЕ ржЕржирзНржп рж░рзЗржлрж╛рж░рж╛рж░ ржЪрзЗржХ
other_referral_query = referrals_ref.where('referred_id', '==', referred_id).limit(1)
```

#### **ржлрж╛ржЗрж▓:** `bot.py`

---

## ЁЯФз **ржЖржкржбрзЗржЯрзЗржб ржлрж╛ржВрж╢ржиржЧрзБрж▓рзЛ**

### **1. `generate_referral_code()`**
- тЬЕ **CP ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕** ржмрзНржпржмрж╣рж╛рж░ (ржлрзНрж░ржирзНржЯржПржирзНржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓)
- тЬЕ **рж╕ржарж┐ржХ ржлрж░ржорзНржпрж╛ржЯ** ржирж┐рж╢рзНржЪрж┐ржд

### **2. `process_referral()`**
- тЬЕ **ржбрзБржкрзНрж▓рж┐ржХрзЗржЯ ржЪрзЗржХ** ржЙржирзНржиржд
- тЬЕ **ржЕржирзНржп рж░рзЗржлрж╛рж░рж╛рж░ ржЪрзЗржХ** ржпрзЛржЧ
- тЬЕ **рж╕ржарж┐ржХ рж▓ржЧрж┐ржВ** ржпрзЛржЧ

### **3. `start_command()`**
- тЬЕ **рж░рж┐ржлрж╛рж░рзЗрж▓ ржХрзЛржб рж▓рзБржХржЖржк** ржЙржирзНржиржд
- тЬЕ **ржкрзНрж░рж╛ржЗржорж╛рж░рж┐ ржорзЗржержб** users ржХрж╛рж▓рзЗржХрж╢ржи
- тЬЕ **ржлрж▓ржмрзНржпрж╛ржХ ржорзЗржержб** referral_codes ржХрж╛рж▓рзЗржХрж╢ржи
- тЬЕ **рж╕рзЗрж▓ржл рж░рзЗржлрж╛рж░рзЗрж▓ ржЪрзЗржХ** ржпрзЛржЧ

---

## ЁЯУК **ржбрж╛ржЯрж╛ ржлрзНрж▓рзЛ**

### **1. рж░рзЗржлрж╛рж░рзЗрж▓ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ:**
```
User starts bot тЖТ Check referral code тЖТ Find referrer тЖТ Process referral тЖТ Create record
```

### **2. ржЧрзНрж░рзБржк ржЬржпрж╝рзЗржи ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи:**
```
User joins group тЖТ Verify membership тЖТ Update referral status тЖТ Reward referrer
```

### **3. рж░рж┐ржУржпрж╝рж╛рж░рзНржб ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи:**
```
Verify group join тЖТ Update referrer balance (+2) тЖТ Update total_earnings (+2) тЖТ Create earnings record
```

---

## ЁЯОп **рж╕рзБржмрж┐ржзрж╛**

### **1. ржХржирж╕рж┐рж╕рзНржЯрзЗржирзНрж╕рж┐**
- тЬЕ **ржлрзНрж░ржирзНржЯржПржирзНржбрзЗрж░ рж╕рж╛ржерзЗ** рж░рж┐ржлрж╛рж░рзЗрж▓ ржХрзЛржб ржорж┐рж▓
- тЬЕ **рж╕ржарж┐ржХ ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕** ржмрзНржпржмрж╣рж╛рж░
- тЬЕ **ржПржХржЗ рж▓ржЬрж┐ржХ** рж╕ржм ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝

### **2. рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐**
- тЬЕ **ржбрзБржкрзНрж▓рж┐ржХрзЗржЯ рж░рзЗржлрж╛рж░рзЗрж▓** ржкрзНрж░рждрж┐рж░рзЛржз
- тЬЕ **рж╕рзЗрж▓ржл рж░рзЗржлрж╛рж░рзЗрж▓** ржкрзНрж░рждрж┐рж░рзЛржз
- тЬЕ **ржЕржирзНржп рж░рзЗржлрж╛рж░рж╛рж░** ржкрзНрж░рждрж┐рж░рзЛржз

### **3. ржкрж╛рж░ржлрж░ржорзЗржирзНрж╕**
- тЬЕ **ржкрзНрж░рж╛ржЗржорж╛рж░рж┐ ржорзЗржержб** ржкрзНрж░ржержорзЗ ржЪрзЗржХ
- тЬЕ **ржлрж▓ржмрзНржпрж╛ржХ ржорзЗржержб** рж╢рзБржзрзБ ржкрзНрж░ржпрж╝рзЛржЬржи рж╣рж▓рзЗ
- тЬЕ **рж╕ржарж┐ржХ ржХрзБржпрж╝рзЗрж░рж┐** ржмрзНржпржмрж╣рж╛рж░

### **4. рж▓ржЧрж┐ржВ**
- тЬЕ **ржбрж┐ржЯрзЗржЗрж▓ржб рж▓ржЧ** рж╕ржм ржЕржкрж╛рж░рзЗрж╢ржи
- тЬЕ **ржПрж░рж░ рж╣рзНржпрж╛ржирзНржбрж▓рж┐ржВ** ржЙржирзНржиржд
- тЬЕ **ржбрж┐ржмрж╛ржЧрж┐ржВ** рж╕рж╣ржЬ

---

## ЁЯФН **ржЯрзЗрж╕рзНржЯрж┐ржВ ржкржпрж╝рзЗржирзНржЯрж╕**

### **1. рж░рж┐ржлрж╛рж░рзЗрж▓ ржХрзЛржб ржЬрзЗржирж╛рж░рзЗрж╢ржи**
- тЬЕ CP ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕ рж╕ржарж┐ржХ
- тЬЕ 6 ржбрж┐ржЬрж┐ржЯ рж╕ржарж┐ржХ
- тЬЕ ржЖржкрж╛рж░ржХрзЗрж╕ рж╕ржарж┐ржХ

### **2. рж░рж┐ржлрж╛рж░рзЗрж▓ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ**
- тЬЕ ржбрзБржкрзНрж▓рж┐ржХрзЗржЯ ржЪрзЗржХ рж╕ржарж┐ржХ
- тЬЕ ржЕржирзНржп рж░рзЗржлрж╛рж░рж╛рж░ ржЪрзЗржХ рж╕ржарж┐ржХ
- тЬЕ рж╕рзЗрж▓ржл рж░рзЗржлрж╛рж░рзЗрж▓ ржЪрзЗржХ рж╕ржарж┐ржХ

### **3. рж░рж┐ржУржпрж╝рж╛рж░рзНржб ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи**
- тЬЕ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржЖржкржбрзЗржЯ рж╕ржарж┐ржХ
- тЬЕ ржЯрзЛржЯрж╛рж▓ ржЖрж░рзНржирж┐ржВрж╕ ржЖржкржбрзЗржЯ рж╕ржарж┐ржХ
- тЬЕ ржЖрж░рзНржирж┐ржВрж╕ рж░рзЗржХрж░рзНржб рж╕ржарж┐ржХ

---

## ЁЯЪА **ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк**

1. **ржЯрзЗрж╕рзНржЯрж┐ржВ** - рж╕ржм ржлрж╛ржВрж╢ржи ржЯрзЗрж╕рзНржЯ ржХрж░рж╛
2. **ржоржирж┐ржЯрж░рж┐ржВ** - рж░рзЗржлрж╛рж░рзЗрж▓ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ ржоржирж┐ржЯрж░
3. **ржЕржкржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи** - ржкрж╛рж░ржлрж░ржорзЗржирзНрж╕ ржЙржирзНржирждрж┐
4. **ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи** - API ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржЖржкржбрзЗржЯ

---

## тЬЕ **рж╕ржорзНржкрзВрж░рзНржг рж╕ржорж╛ржзрж╛ржи**

рж╕ржм **Bot.py** ржПрж░ **Balance ржПржмржВ Earnings** рж╕ржорзНржкрж░рзНржХрж┐ржд **рж╕ржорж╕рзНржпрж╛ржЧрзБрж▓рзЛ** рж╕ржлрж▓ржнрж╛ржмрзЗ **рж╕ржорж╛ржзрж╛ржи** ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржПржЦржи:

- тЬЕ **рж░рж┐ржлрж╛рж░рзЗрж▓ ржХрзЛржб** ржлрзНрж░ржирзНржЯржПржирзНржбрзЗрж░ рж╕рж╛ржерзЗ ржорж┐рж▓ржЫрзЗ (CP ржкрзНрж░рж┐ржлрж┐ржХрзНрж╕)
- тЬЕ **рж░рж┐ржлрж╛рж░рзЗрж▓ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ** рж╕рзБрж░ржХрзНрж╖рж┐ржд рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ **ржбрзБржкрзНрж▓рж┐ржХрзЗржЯ рж░рзЗржлрж╛рж░рзЗрж▓** ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ **рж░рж┐ржУржпрж╝рж╛рж░рзНржб ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙрж╢ржи** рж╕ржарж┐ржХ рж╣ржпрж╝рзЗржЫрзЗ
- тЬЕ **рж▓ржЧрж┐ржВ** ржЙржирзНржиржд рж╣ржпрж╝рзЗржЫрзЗ

**Bot.py ржПржЦржи рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржПржмржВ ржлрзНрж░ржирзНржЯржПржирзНржбрзЗрж░ рж╕рж╛ржерзЗ рж╕рж╛ржоржЮрзНржЬрж╕рзНржпржкрзВрж░рзНржг!** ЁЯОЙ
